<style>
  .tsw-countdown {
    --tsw-font-display: "TeleNeo Web", var(--phx--text-family-brand), -apple-system, BlinkMacSystemFont, "Segoe UI",
      Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    --tsw-font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif,
      "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";

    --tsw-font-size: 16px;
    --color-brand-primary-400: #e20074;
    --color-brand-grayscale-900: #1c1c1c;
    --color-brand-grayscale-white: #fff;

    --countdown-text-color: var(--color-brand-grayscale-900);
    --countdown-background-color: var(--color-brand-grayscale-white);
    --time-unit-text-color: var(--color-brand-grayscale-white);
    --time-unit-background-color: var(--color-brand-grayscale-900);

    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    padding: 2rem;
    font-family: var(--tsw-font-main);
    color: var(--countdown-text-color);
    background-color: var(--countdown-background-color);
  }

  .tsw-countdown.dark-theme {
    --countdown-text-color: var(--color-brand-grayscale-white);
    --countdown-background-color: var(--color-brand-grayscale-900);
    --time-unit-text-color: var(--color-brand-grayscale-900);
    --time-unit-background-color: var(--color-brand-grayscale-white);
  }

  /* Interface */

  .tsw-countdown-interface button {
    padding: 10px 15px;
    font-size: 14px;
    font-weight: 700;
    color: var(--color-brand-grayscale-white);
    border: 1px solid var(--color-brand-primary-400);
    background-color: var(--color-brand-primary-400);
  }

  /* Modal and overlay */

  .tsw-modal {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70vw;
    max-width: 800px;
    background-color: var(--color-brand-grayscale-white);
    z-index: 1001;
  }

  .tsw-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    z-index: 1000;
    display: flex;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(7px);
    -webkit-backdrop-filter: blur(7px);
    z-index: 1000;
    display: none;
  }
  .tsw-modal-overlay.is-visible {
    display: block;
  }

  /* Clock */

  .tsw-countdown-clock {
    display: grid;
    grid-template-columns: 1fr auto 1fr auto 1fr auto 1fr;
    align-items: center;
    gap: 1rem;
  }

  .tsw-countdown-clock .tsw-time-unit {
    flex: 1;
    text-align: center;
    padding: 1rem;
    color: var(--time-unit-text-color);
    background-color: var(--time-unit-background-color);
    border-radius: 0.5rem;
  }

  .tsw-countdown-clock .tsw-time-unit .tsw-number {
    display: block;
    font-size: 3rem;
    line-height: 4rem;
    font-weight: 700;
    color: var(--color-brand-primary-400);
  }

  .tsw-countdown-clock .tsw-time-colon {
    font-size: 3rem;
    font-weight: 800;
  }

  /* Status */

  .tsw-countdown-status {
    display: none;
    text-align: center;
  }
  .tsw-countdown-status .tsw-countdown-status-alert {
    margin: 0;
    color: var(--color-brand-primary-400);
  }
</style>

<div class="tsw-countdown">
  <div class="tsw-countdown-interface">
    <button class="tsw-countdown-edit">Edit countdown clock</button>
  </div>

  <div class="tsw-modal-overlay is-visible">
    <div class="tsw-modal">TEST</div>
  </div>

  <div class="tsw-countdown-clock">
    <div class="tsw-time-unit">
      <span class="tsw-countdown-days tsw-number">--</span>
      <span>Days</span>
    </div>
    <span class="tsw-time-colon">:</span>
    <div class="tsw-time-unit">
      <span class="tsw-countdown-hours tsw-number">--</span>
      <span>Hours</span>
    </div>
    <span class="tsw-time-colon">:</span>
    <div class="tsw-time-unit">
      <span class="tsw-countdown-minutes tsw-number">--</span>
      <span>Minutes</span>
    </div>
    <span class="tsw-time-colon">:</span>
    <div class="tsw-time-unit">
      <span class="tsw-countdown-seconds tsw-number">--</span>
      <span>Seconds</span>
    </div>
  </div>

  <div class="tsw-countdown-status">
    <p class="tsw-countdown-status-alert"></p>
  </div>

  <div
    id="tsw-countdown-a11y-alert"
    role="alert"
    aria-live="assertive"
    style="position: absolute; width: 0; height: 0; clip: rect(0, 0, 0, 0)"
  ></div>
</div>

<script>
  const CountDownClock = {
    countDownToThisTime: null,
    countDown: null,
    timeZoneForTarget: "local",
    theme: "light",
    urgencyInterval: 1,
    a11yAlertInterval: 10,
    init(selectedDateArg, timeZoneArg, themeArg, urgencyIntervalArg, a11yAlertIntervalArg) {
      this.countDownWrapper = document.querySelector("#tsw-countdown-id").querySelector("xpr-npi-content");
      this.countDownEl = this.countDownWrapper.shadowRoot.querySelector(".tsw-countdown");
      if (!this.countDownEl) return;
      if (a11yAlertIntervalArg !== undefined) {
        if (!Number.isInteger(a11yAlertIntervalArg)) {
          throw new Error("Argument is not a number");
        }
        this.a11yAlertInterval = a11yAlertIntervalArg;
      }
      this.timeZoneForTarget = timeZoneArg;
      this.urgencyInterval = urgencyIntervalArg;
      this.theme = themeArg;
      this.countDownToThisTime = this.setTimeZoneForTarget(selectedDateArg);
      this.setTheme(this.theme);
      this.countDown = this.startCountDown();
    },
    setTimeZoneForTarget(date) {
      if (this.timeZoneForTarget === "eastern") {
        // Set time zone of input date/time using Luxon DateTime object
        const overrideZone = luxon.DateTime.fromISO(date, { zone: "America/New_York" });
        // Convert back to local time and to a Date object using Luxon's toJSDate() method
        return overrideZone.toJSDate();
      } else {
        return new Date(date);
      }
    },
    setTheme(theme) {
      theme === "dark" ? this.countDownEl.classList.add("dark-theme") : this.countDownEl.classList.remove("dark-theme");
    },
    startCountDown() {
      return setInterval(() => {
        const secondsLeft = (this.countDownToThisTime - Date.now()) / 1000;
        if (secondsLeft < 0) {
          this.stopClock();
        }
        this.setView(secondsLeft);
      }, 1000);
    },
    setView(seconds) {
      const displayDays = this.countDownEl.querySelector(".tsw-countdown-days");
      const displayHours = this.countDownEl.querySelector(".tsw-countdown-hours");
      const displayMinutes = this.countDownEl.querySelector(".tsw-countdown-minutes");
      const displaySeconds = this.countDownEl.querySelector(".tsw-countdown-seconds");
      const statusWrapper = this.countDownEl.querySelector(".tsw-countdown-status");
      const statusAlert = this.countDownEl.querySelector(".tsw-countdown-status-alert");
      const a11yAlert = this.countDownEl.querySelector("#tsw-countdown-a11y-alert");
      const secs = Math.floor(seconds % 60);
      const mins = Math.floor((seconds / 60) % 60);
      const hrs = Math.floor((seconds / (60 * 60)) % 24);
      const dys = Math.floor(seconds / (60 * 60 * 24));
      displaySeconds.textContent = secs > 0 ? (secs < 10 ? "0" + secs : secs) : "00";
      displayMinutes.textContent = mins > 0 ? (mins < 10 ? "0" + mins : mins) : "00";
      displayHours.textContent = hrs > 0 ? (hrs < 10 ? "0" + hrs : hrs) : "00";
      displayDays.textContent = dys > 0 ? (dys < 10 ? "0" + dys : dys) : "00";
      if (dys < this.a11yAlertInterval) {
        a11yAlert.textContent = "Less than 24 hours to go!!!";
      } else {
        a11yAlert.textContent = "";
      }
      if (dys < this.urgencyInterval) {
        statusWrapper.style.display = "block";
        statusAlert.textContent = "Less than 24 hours to go!!!";
      } else {
        statusWrapper.style.display = "none";
        statusAlert.textContent = "";
      }
    },
    stopClock() {
      clearInterval(this.countDown);
      this.countDownToThisTime = null;
    },
  };

  window.addEventListener("load", () => {
    const targetDate = "2025-10-31T13:33";
    CountDownClock.init(targetDate, "local", "light", 1, 30);
  });

  // Modal and overlay

  const countdownWrapper = document.querySelector("#tsw-countdown-id").querySelector("xpr-npi-content").shadowRoot;
  const modalOverlay = countdownWrapper.querySelector(".tsw-modal-overlay");

  modalOverlay.addEventListener("click", () => {
    modalOverlay.classList.remove("is-visible");
  });
</script>
