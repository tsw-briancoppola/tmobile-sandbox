<!-- HS List - CSS -->

<style>
  .tsw-hs-list-container {
    --tsw-font-display: "TeleNeo Web", var(--phx--text-family-brand), -apple-system, BlinkMacSystemFont, "Segoe UI",
      Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    --tsw-font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif,
      "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";

    --tsw-font-size: 16px;
    --color-brand-primary-400: #e20074;
    --color-brand-primary-600: #770141;
    --color-brand-grayscale-100: #fbfbfb;
    --color-brand-grayscale-200: #f5f5f5;
    --color-brand-grayscale-300: #e6e6e6;
    --color-brand-grayscale-400: #ccc;
    --color-brand-grayscale-500: #8c8c8c;
    --color-brand-grayscale-600: #6a6a6a;
    --color-brand-grayscale-700: #414141;
    --color-brand-grayscale-900: #1c1c1c;
    --color-brand-grayscale-white: #fff;

    --color-overlay: rgba(0, 0, 0, 0.4);
    --color-input-shadow: 0px 0px 5px 0px rgba(226, 0, 116, 0.5);

    font-family: var(--tsw-font-main);

    --hs-list-text-color: var(--color-brand-grayscale-600);
    --hs-list-highlight-color: var(--color-brand-primary-400);
    --hs-list-background-color: var(--color-brand-grayscale-200);

    color: var(--hs-list-text-color);
    background-color: var(--hs-list-background-color);
  }

  .tsw-hs-list-container.dark-theme {
    --hs-list-text-color: var(--color-brand-grayscale-white);
    --hs-list-highlight-color: var(--color-brand-primary-400);
    --hs-list-background-color: var(--color-brand-grayscale-900);
  }

  /* Reset */

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    font-size: 62.5%;
  }

  body {
    font-size: 1.6rem;
    overflow-x: hidden;
    height: 100vh;
    margin: 0;
    background-color: #f5f5f5;
  }

  ul {
    list-style-type: none;
  }

  /* UI element styles */

  .button-magenta {
    cursor: pointer;
    padding: 1rem 1.5rem;
    font-size: 1.4rem;
    font-weight: 700;
    border: 0;
    color: var(--color-brand-grayscale-white);
    background-color: var(--color-brand-primary-400);
    box-shadow: 2px 2px 7px rgba(0, 0, 0, 0.5);
  }

  /* List container styles */

  .tsw-hs-list-container {
    padding: 3rem;
    max-width: 110rem;
    min-height: 90rem;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3rem;
    background-color: var(--hs-list-background-color);
  }

  /* Search and pagination styles */

  .tsw-hs-list-search-container {
    position: relative;
    width: fit-content;
    display: flex;
    align-items: center;
  }
  .tsw-hs-list-search-container label {
    display: none;
  }
  .tsw-hs-list-search-container input {
    border: 1px solid rgb(140, 140, 140);
    border-radius: 0.4rem;
    font-size: 1.6rem;
    line-height: 2rem;
    min-width: 34rem;
    padding: 1.2rem 3.2rem 1.2rem 1.2rem;
    outline-offset: 0.2rem;
  }

  .tsw-hs-list-pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 2rem;
    width: 100%;
    max-width: 40rem;
  }
  .tsw-hs-list-pagination.is-hidden {
    display: none;
  }

  .tsw-pagination-numbers {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .tsw-hs-list-search-clear,
  .tsw-pagination-prev,
  .tsw-pagination-next {
    width: 2.5rem;
    height: 2.5rem;
    border: 0;
    background-color: inherit;
    cursor: pointer;
  }

  .tsw-hs-list-search-clear svg,
  .tsw-pagination-prev svg,
  .tsw-pagination-next svg {
    height: 100%;
    width: 100%;
  }

  .tsw-hs-list-search-clear {
    display: none;
    position: absolute;
    right: 0.7rem;
  }
  .tsw-hs-list-search-clear svg {
    fill: var(--hs-list-text-color);
  }

  .tsw-pagination-prev svg,
  .tsw-pagination-next svg {
    fill: var(--hs-list-highlight-color);
  }
  .tsw-pagination-prev:disabled svg,
  .tsw-pagination-next:disabled svg {
    cursor: not-allowed;
    fill: var(--hs-list-text-color);
  }

  .tsw-pagination-number {
    cursor: pointer;
    padding: 1rem 1.5rem;
    font-size: 1.5rem;
    border: 0;
    border-radius: 0.5rem;
    color: var(--button-text-color);
    background-color: var(--button-background-color);
  }
  .tsw-pagination-number.active {
    color: var(--color-brand-grayscale-white);
    background-color: var(--color-brand-primary-400);
  }

  /* List styles */

  .tsw-hs-list {
    display: flex;
    flex-direction: column;
    flex: 1;
    width: 100%;
  }

  .tsw-hs-list__row {
    display: grid;
    grid-template-columns: 1fr;
    place-items: center;
    gap: 3rem;
    padding: 1.2rem 1.4rem;
    border-top: 1px solid var(--color-brand-grayscale-300);
  }
  @media (min-width: 600px) {
    .tsw-hs-list__row {
      grid-template-columns: 2fr 1fr 1fr 1fr;
      place-items: initial;
    }
  }

  .tsw-hs-list__row:first-child {
    border: 0;
  }

  .tsw-hs-list__row a {
    text-decoration: none;
    color: var(--hs-list-highlight-color);
  }

  .tsw-hs-list-empty {
    display: none;
    flex: 1;
  }
  .tsw-hs-list-empty.active {
    display: block;
  }

  /* List svg icon styles */

  .tsw-hs-list-svg-icons {
    display: none;
  }
</style>

<!-- HS List - HTML -->

<div class="tsw-hs-list-container">
  <search class="tsw-hs-list-search-container">
    <label for="tsw-hs-list-search">Search the list:</label>
    <input type="text" id="tsw-hs-list-search" name="q" placeholder="Enter school name, city, or state" />
    <button type="button" class="tsw-hs-list-search-clear">
      <svg>
        <use xlink:href="#tsw-hs-list-search-clear-svg" />
      </svg>
    </button>
  </search>

  <div class="tsw-hs-list"></div>
  <div class="tsw-hs-list-empty"><p>No results found!</p></div>

  <div class="tsw-hs-list-pagination">
    <button type="button" class="tsw-pagination-prev" aria-label="Previous Page" disabled>
      <svg>
        <use xlink:href="#tsw-hs-list-back-arrow-svg" />
      </svg>
    </button>
    <div class="tsw-pagination-numbers"></div>
    <button type="button" class="tsw-pagination-next" aria-label="Next Page">
      <svg>
        <use xlink:href="#tsw-hs-list-forward-arrow-svg" />
      </svg>
    </button>
  </div>

  <div class="tsw-hs-list-settings">
    <button type="button" class="tsw-hs-list-theme-toggle button-magenta">Switch theme</button>
  </div>
</div>

<!-- SVG icons -->
<div class="tsw-hs-list-svg-icons">
  <svg
    id="tsw-hs-list-search-clear-svg"
    xmlns="http://www.w3.org/2000/svg"
    height="24px"
    viewBox="0 -960 960 960"
    width="24px"
  >
    <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z" />
  </svg>
  <svg
    id="tsw-hs-list-back-arrow-svg"
    xmlns="http://www.w3.org/2000/svg"
    height="24px"
    viewBox="0 -960 960 960"
    width="24px"
  >
    <path d="M640-80 240-480l400-400 71 71-329 329 329 329-71 71Z" />
  </svg>
  <svg
    id="tsw-hs-list-forward-arrow-svg"
    xmlns="http://www.w3.org/2000/svg"
    height="24px"
    viewBox="0 -960 960 960"
    width="24px"
  >
    <path d="m321-80-71-71 329-329-329-329 71-71 400 400L321-80Z" />
  </svg>

  <!-- HS List - JavaScript -->

  <script>
    const mockData = [
      {
        id: 1,
        name: "Oyoyo",
        city: "Saint Louis",
        state: "MO",
        website: "https://cargocollective.com/eget/eleifend/luctus/ultricies/eu/nibh.html",
      },
      {
        id: 2,
        name: "Trupe",
        city: "Kansas City",
        state: "MO",
        website: "https://uol.com.br/massa/id/nisl/venenatis.jsp",
      },
      {
        id: 3,
        name: "Skiptube",
        city: "Roanoke",
        state: "VA",
        website: "https://hexun.com/faucibus/orci.png",
      },
      {
        id: 4,
        name: "Youfeed",
        city: "Decatur",
        state: "IL",
        website: "http://w3.org/turpis/sed/ante/vivamus/tortor/duis.json",
      },
      {
        id: 5,
        name: "Browsetype",
        city: "San Antonio",
        state: "TX",
        website: "http://printfriendly.com/at/nunc/commodo.jpg",
      },
      {
        id: 6,
        name: "Dabvine",
        city: "Cape Coral",
        state: "FL",
        website: "https://woothemes.com/vitae/nisl/aenean/lectus/pellentesque/eget/nunc.jpg",
      },
      {
        id: 7,
        name: "Topicblab",
        city: "Shawnee Mission",
        state: "KS",
        website: "http://wikia.com/nisi/volutpat/eleifend/donec/ut/dolor.js",
      },
      {
        id: 8,
        name: "Podcat",
        city: "San Francisco",
        state: "CA",
        website: "https://phoca.cz/tortor/id.aspx",
      },
      {
        id: 9,
        name: "Voomm",
        city: "Lakeland",
        state: "FL",
        website: "http://tumblr.com/a/libero/nam/dui/proin/leo.jpg",
      },
      {
        id: 10,
        name: "Jetpulse",
        city: "Arlington",
        state: "VA",
        website: "https://wisc.edu/integer.jsp",
      },
      {
        id: 11,
        name: "Topiczoom",
        city: "Akron",
        state: "OH",
        website: "http://cdc.gov/cras/pellentesque/volutpat/dui/maecenas/tristique.aspx",
      },
      {
        id: 12,
        name: "Meejo",
        city: "Tucson",
        state: "AZ",
        website: "http://va.gov/justo/aliquam.js",
      },
      {
        id: 13,
        name: "Dynabox",
        city: "Cape Coral",
        state: "FL",
        website: "https://army.mil/eget.jsp",
      },
      {
        id: 14,
        name: "Feedfire",
        city: "Dallas",
        state: "TX",
        website: "https://devhub.com/in/felis/eu.xml",
      },
      {
        id: 15,
        name: "Mita",
        city: "Saint Paul",
        state: "MN",
        website: "http://people.com.cn/sed/augue/aliquam/erat.aspx",
      },
      {
        id: 16,
        name: "Voolia",
        city: "Washington",
        state: "DC",
        website: "https://java.com/penatibus/et/magnis/dis/parturient/montes/nascetur.xml",
      },
      {
        id: 17,
        name: "Twitternation",
        city: "Seattle",
        state: "WA",
        website: "http://newyorker.com/pede/lobortis/ligula/sit/amet.aspx",
      },
      {
        id: 18,
        name: "Meetz",
        city: "Milwaukee",
        state: "WI",
        website: "https://google.it/dictumst/maecenas/ut/massa/quis/augue.xml",
      },
      {
        id: 19,
        name: "Shuffledrive",
        city: "Springfield",
        state: "MO",
        website: "https://ycombinator.com/molestie/sed/justo.jsp",
      },
      {
        id: 20,
        name: "Edgetag",
        city: "Washington",
        state: "DC",
        website: "https://cbc.ca/consectetuer/adipiscing/elit/proin/risus/praesent/lectus.aspx",
      },
      {
        id: 21,
        name: "Jaxnation",
        city: "Chicago",
        state: "IL",
        website: "https://opera.com/felis/donec/semper/sapien.json",
      },
      {
        id: 22,
        name: "Midel",
        city: "Houston",
        state: "TX",
        website: "https://forbes.com/eleifend/donec.png",
      },
      {
        id: 23,
        name: "Babblestorm",
        city: "Garden Grove",
        state: "CA",
        website: "http://1und1.de/vel/augue/vestibulum/ante/ipsum/primis/in.js",
      },
      {
        id: 24,
        name: "Npath",
        city: "New York City",
        state: "NY",
        website: "https://hexun.com/sagittis/dui/vel/nisl.html",
      },
      {
        id: 25,
        name: "Yodoo",
        city: "Irving",
        state: "TX",
        website: "https://bravesites.com/penatibus.json",
      },
    ];
  </script>

  <script>
    const hsListWrapper = document.querySelector("#tsw-hs-list").querySelector("xpr-npi-content").shadowRoot;

    const searchBox = hsListWrapper.querySelector("#tsw-hs-list-search");
    const searchClearButton = hsListWrapper.querySelector(".tsw-hs-list-search-clear");
    const list = hsListWrapper.querySelector(".tsw-hs-list");
    const listEmpty = hsListWrapper.querySelector(".tsw-hs-list-empty");
    const paginationContainer = hsListWrapper.querySelector(".tsw-hs-list-pagination");
    const prevButton = hsListWrapper.querySelector(".tsw-pagination-prev");
    const nextButton = hsListWrapper.querySelector(".tsw-pagination-next");
    const paginationNumbersContainer = hsListWrapper.querySelector(".tsw-pagination-numbers");

    let currentPage = 0;
    const itemsPerPage = 10;

    // =-=-=-=-=-=-=-=-=-
    // Pull data from API
    // =-=-=-=-=-=-=-=-=-

    const API_URL = "https://playground.mockoon.com/contacts";
    let apiData = [];
    let currentDataSet = []; // Subset of all data that passes search requirements

    const fetchApiData = async () => {
      // const url = `${API_URL}?page=${currentPage}&limit=${itemsPerPage}`;

      try {
        const response = await fetch("./data/mock_data.json");
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        return data;
      } catch (error) {
        console.error("Error fetching data:", error);
        return null;
      }
    };

    // =-=-=-=-=-
    // Pagination
    // =-=-=-=-=-

    const updatePaginationButtons = () => {
      const totalPages = Math.ceil(currentDataSet.length / itemsPerPage);

      prevButton.disabled = currentPage === 0;
      nextButton.disabled = currentPage >= totalPages - 1;
    };

    prevButton.addEventListener("click", () => {
      if (currentPage > 0) {
        currentPage--;
        renderData(currentDataSet);
      }
    });

    nextButton.addEventListener("click", () => {
      const totalPages = Math.ceil(currentDataSet.length / itemsPerPage);
      if (currentPage < totalPages - 1) {
        currentPage++;
        renderData(currentDataSet);
      }
    });

    // =-=-=-=-=-=-=-=-=-
    // Pagination numbers
    // =-=-=-=-=-=-=-=-=-

    const createPaginationNumber = (index, text) => {
      const button = document.createElement("button");
      button.textContent = text;
      button.classList.add("tsw-pagination-number");

      if (index === currentPage) {
        button.classList.add("active");
        button.disabled = true; // Current page shouldn't be clickable
      } else {
        button.addEventListener("click", () => {
          currentPage = index;
          renderData(currentDataSet);
        });
      }

      paginationNumbersContainer.appendChild(button);
    };

    const createEllipsis = () => {
      const span = document.createElement("span");
      span.textContent = "...";
      span.classList.add("tsw-pagination-ellipsis");
      paginationNumbersContainer.appendChild(span);
    };

    const renderPaginationNumbers = () => {
      paginationNumbersContainer.innerHTML = "";

      const totalPages = Math.ceil(currentDataSet.length / itemsPerPage);

      // Hide pagination if there are less than 2 pages
      const shouldHidePagination = totalPages <= 1;
      paginationContainer.classList.toggle("is-hidden", shouldHidePagination);

      if (shouldHidePagination) {
        return;
      }

      const indexForThirdToLastPage = totalPages - 3;
      const isNearEnd = currentPage >= indexForThirdToLastPage;

      // Near the end
      if (isNearEnd) {
        let startIndex = Math.max(0, totalPages - 3);

        for (let i = startIndex; i < totalPages; i++) {
          createPaginationNumber(i, (i + 1).toString());
        }
      }
      // Middle pages
      else {
        console.log("middle");
        const startPageIdx = currentPage;
        const endPageIdx = currentPage + 2;

        for (let i = startPageIdx; i <= endPageIdx; i++) {
          if (i >= totalPages - 1) break;
          createPaginationNumber(i, (i + 1).toString());
        }

        if (endPageIdx < totalPages - 1) {
          createEllipsis();
          // Add the very last page index
          createPaginationNumber(totalPages - 1, totalPages.toString());
        }
      }
    };

    // =-=-=-=-=-=-=-=-=-=
    // Render data in list
    // =-=-=-=-=-=-=-=-=-=

    const createRow = (school) => {
      const dataRow = document.createElement("div");
      dataRow.classList.add("tsw-hs-list__row");

      dataRow.innerHTML = `
    <div class="tsw-hs-list__row--name">${school.name}</div>
    <div class="tsw-hs-list__row--city">${school.city}</div>
    <div class="tsw-hs-list__row--state">${school.state}</div>
    <div class="tsw-hs-list__row--website">
      <a href="${school.website}" target="_blank">School website</a>
    </div>
  `;

      return dataRow;
    };

    const clearData = () => {
      list.innerHTML = "";
    };

    const renderData = (data) => {
      clearData();

      // Creating fragment for better performance
      const fragment = document.createDocumentFragment();

      // Toggle 'No results' notice based on data length
      listEmpty.classList.toggle("active", data.length === 0);

      // Get current page slice of page data
      const startItem = currentPage * itemsPerPage;
      const endItem = startItem + itemsPerPage;
      const pageData = data.slice(startItem, endItem);

      pageData.forEach((school) => {
        const row = createRow(school);
        fragment.appendChild(row);
      });

      list.appendChild(fragment);
      updatePaginationButtons();
      renderPaginationNumbers();
    };

    // =-=-=-=-=-=-=-=-=
    // Debounce function
    // =-=-=-=-=-=-=-=-=

    const debounce = (func, delay = 200) => {
      let timeoutId;

      return function (...args) {
        clearTimeout(timeoutId);

        timeoutId = setTimeout(() => {
          func.apply(this, args);
        }, delay);
      };
    };

    // =-=-=-=-=-=-=-=-=-=-=-=-
    // Search box and filtering
    // =-=-=-=-=-=-=-=-=-=-=-=-

    const filterData = (data, value) => {
      const filtered = data.filter((row) => {
        // Return true only if search value is contained in school's name, city, or state
        const rowValues = [row.name, row.city, row.state];
        return rowValues.some((d) => d.toLowerCase().includes(value.toLowerCase()));
      });

      return filtered;
    };

    const updateRenderedData = (value) => {
      currentPage = 0; // Reset page to 0 when search terms change
      currentDataSet = filterData(apiData, value);
      renderData(currentDataSet);
    };

    // Set debounce to 200ms
    const debouncedUpdate = debounce(updateRenderedData, 200);

    // Toggle display of search box clear button
    const searchClearButtonToggle = () => {
      searchBox.value ? (searchClearButton.style.display = "block") : (searchClearButton.style.display = "none");
    };

    // Event listener for search box
    searchBox.addEventListener("input", () => {
      debouncedUpdate(searchBox.value);
      searchClearButtonToggle();
    });

    // Clear search box when clear button is clicked
    searchClearButton.addEventListener("click", () => {
      searchBox.value = "";
      searchBox.focus();
      searchClearButtonToggle();
      updateRenderedData("");
    });

    // =-=-=-=-=-=-
    // Toggle theme
    // =-=-=-=-=-=-

    const listContainer = hsListWrapper.querySelector(".tsw-hs-list-container");
    const themeToggleButton = hsListWrapper.querySelector(".tsw-hs-list-theme-toggle");

    themeToggleButton.addEventListener("click", () => {
      listContainer.classList.toggle("dark-theme");
    });

    // =-=-=-=
    // On load
    // =-=-=-=

    const init = async () => {
      // =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
      // Use the following code when an API is known:
      // =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-

      // const data = await fetchApiData();
      // if (data) {
      //   // Convert pulled data to new data objects with desired properties
      //   const newDataArray = data.map(({ name, address, profilePicture }) => {
      //     let { city, state } = address ?? {};
      //     const website = profilePicture;
      //     state = stateAbbreviations[state];
      //     return { name, city, state, website };
      //   });
      //   // Set data size
      //   apiData = newDataArray.filter((_, index) => index < 40);
      //   currentDataSet = [...apiData];
      //   // Render data
      //   renderData(currentDataSet);
      // }

      const newDataArray = mockData.map(({ name, city, state, website }) => {
        return { name, city, state, website };
      });

      apiData = newDataArray.filter((_, index) => index < 55);
      currentDataSet = [...apiData];
      // Render data
      renderData(currentDataSet);
    };

    init();
  </script>
</div>
